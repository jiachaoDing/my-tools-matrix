<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV to JSON Converter - Instant & Batch Processing | WebUtilityKit</title>
    <meta name="description" content="Convert CSV to JSON instantly in your browser. Supports batch files, auto-header detection, and custom delimiters. 100% private and unlimited.">
    <link rel="canonical" href="https://webutilitykit.com/csv-to-json/">
    <link href="../assets/css/styles.css" rel="stylesheet">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "CSV to JSON Converter",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "823",
        "bestRating": "5",
        "worstRating": "1"
      },
      "featureList": "Client-side processing, No server upload, Batch processing, Dark mode",
      "screenshot": "https://webutilitykit.com/assets/screenshots/csv-to-json.jpg"
    }
    </script>
    
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 font-sans min-h-screen flex flex-col transition-colors">
    
    <main class="flex-grow w-full py-12 px-4 sm:px-6">
        
        <div class="max-w-4xl mx-auto text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-4 text-slate-900 dark:text-white">CSV to JSON Converter</h1>
            <p class="text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">Transform CSV data into structured JSON format instantly with automatic header detection and flexible parsing options.</p>
            <div class="mt-6 flex items-center justify-center gap-2 text-sm font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-900/20 py-1.5 px-4 rounded-full w-fit mx-auto">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                <span>100% Secure. Processed locally.</span>
            </div>
        </div>

        <div id="tool-wrapper" class="w-full max-w-[1920px] px-6 mx-auto mb-24">
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 items-start">
                
                <!-- Input Section -->
                <div class="flex flex-col h-full">
                    <div class="bg-white dark:bg-slate-800/50 rounded-3xl overflow-hidden flex flex-col h-full">
                        <div class="p-6 flex flex-col flex-1">
                            <div class="flex items-center justify-between mb-4">
                                <label class="text-sm font-semibold uppercase tracking-wider text-slate-500">CSV Data</label>
                                <div class="flex gap-2">
                                    <button id="upload-btn" class="text-xs px-3 py-1.5 rounded-lg bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/40 transition flex items-center gap-1.5">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                        Upload Files
                                    </button>
                                    <button id="paste-btn" class="text-xs px-3 py-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition flex items-center gap-1.5">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                                        Paste
                                    </button>
                                    <button id="clear-btn" class="text-xs px-3 py-1.5 rounded-lg bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40 transition flex items-center gap-1.5">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                        Clear
                                    </button>
                                </div>
                            </div>

                            <!-- Drag & Drop Zone -->
                            <div id="drop-zone" class="relative flex-1 border-2 border-dashed border-blue-300 dark:border-blue-600 rounded-2xl transition-all hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50/30 dark:hover:bg-blue-900/20 cursor-pointer bg-slate-50/50 dark:bg-slate-900/30">
                                <input type="file" id="file-input" accept=".csv,.txt" multiple class="hidden">
                                <textarea 
                                    id="csv-input" 
                                    class="absolute inset-0 w-full h-full p-6 pt-14 text-sm font-mono bg-transparent border-0 focus:ring-0 resize-none placeholder-slate-400 transition z-10"
                                    placeholder="name,age,city&#10;John,30,New York&#10;Jane,25,Los Angeles"
                                ></textarea>
                                <!-- Drop Zone Hint -->
                                <div class="absolute top-3 left-0 right-0 text-center pointer-events-none z-0">
                                    <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 rounded-lg text-xs font-medium">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                        Click or drag CSV files here, or paste text below
                                    </div>
                                </div>
                                <div id="drop-overlay" class="absolute inset-0 hidden items-center justify-center bg-blue-100/95 dark:bg-blue-900/95 backdrop-blur-sm rounded-2xl z-20 border-2 border-blue-500 dark:border-blue-400">
                                    <div class="text-center">
                                        <svg class="w-20 h-20 mx-auto text-blue-600 dark:text-blue-300 mb-4 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                        <p class="text-2xl font-bold text-blue-900 dark:text-blue-100 mb-2">Drop files here</p>
                                        <p class="text-sm text-blue-700 dark:text-blue-300">Supports multiple .csv or .txt files</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Uploaded Files List -->
                            <div id="uploaded-files" class="mt-4 hidden">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-slate-500">Uploaded Files</span>
                                    <span id="file-count" class="text-xs text-slate-600 dark:text-slate-400"></span>
                                </div>
                                <div id="file-list" class="space-y-2 max-h-32 overflow-y-auto"></div>
                            </div>

                            <!-- Status Badge -->
                            <div id="input-status" class="mt-4 flex items-center gap-2 text-sm font-medium hidden">
                                <svg id="status-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
                                <span id="status-text"></span>
                            </div>
                        </div>
                        
                        <!-- Settings & Action -->
                        <div class="p-6 pt-0 space-y-4">
                            <!-- Options -->
                            <div class="bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 space-y-3">
                                <div class="flex items-center justify-between">
                                    <label for="delimiter" class="text-xs font-semibold uppercase tracking-wider text-slate-500">Delimiter</label>
                                    <select id="delimiter" class="text-sm px-3 py-1.5 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-blue-500/20 transition">
                                        <option value=",">Comma (,)</option>
                                        <option value=";">Semicolon (;)</option>
                                        <option value="\t">Tab</option>
                                        <option value="|">Pipe (|)</option>
                                    </select>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label for="has-header" class="text-xs font-semibold uppercase tracking-wider text-slate-500">First Row is Header</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="has-header" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/20 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label for="format-output" class="text-xs font-semibold uppercase tracking-wider text-slate-500">Prettify Output</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="format-output" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/20 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <button id="convert-btn" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-2xl transition-all shadow-lg shadow-blue-500/20 active:scale-[0.98] flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
                                <span id="convert-btn-text">Convert to JSON</span>
                            </button>
                            
                            <button id="sample-btn" class="w-full py-3 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 font-semibold rounded-2xl transition-all active:scale-[0.98] flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                Load Sample
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="flex flex-col h-full">
                    <div class="bg-white dark:bg-slate-800/50 rounded-3xl overflow-hidden flex flex-col h-full">
                        <div class="p-6 flex flex-col flex-1">
                            <div class="flex items-center justify-between mb-4">
                                <label for="json-output" class="text-sm font-semibold uppercase tracking-wider text-slate-500">JSON Output</label>
                                <div class="flex gap-2">
                                    <button id="copy-btn" class="text-xs px-3 py-1.5 rounded-lg bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/40 transition flex items-center gap-1.5">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                        Copy
                                    </button>
                                </div>
                            </div>
                            <textarea 
                                id="json-output" 
                                class="flex-1 w-full min-h-[450px] p-6 text-sm font-mono bg-slate-50/50 dark:bg-slate-900/50 border-0 focus:ring-2 focus:ring-green-500/20 rounded-2xl resize-none placeholder-slate-400 transition"
                                placeholder="JSON data will appear here..."
                                readonly
                            ></textarea>
                            
                            <!-- Processed Files List -->
                            <div id="processed-files" class="mt-4 hidden">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-xs font-semibold uppercase tracking-wider text-slate-500">Processed Files</span>
                                    <button id="download-all-btn" class="text-xs px-3 py-1 rounded-lg bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/40 transition flex items-center gap-1.5">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                        Download All
                                    </button>
                                </div>
                                <div id="processed-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                            </div>

                            <!-- Stats -->
                            <div class="mt-4 grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-xs text-slate-500 dark:text-slate-400 font-medium uppercase">Objects</div>
                                    <div id="stat-objects" class="text-sm font-bold text-slate-700 dark:text-slate-300 mt-1">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-slate-500 dark:text-slate-400 font-medium uppercase">Fields</div>
                                    <div id="stat-fields" class="text-sm font-bold text-slate-700 dark:text-slate-300 mt-1">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-xs text-slate-500 dark:text-slate-400 font-medium uppercase">Size</div>
                                    <div id="stat-size" class="text-sm font-bold text-slate-700 dark:text-slate-300 mt-1">0 B</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Result Message -->
                        <div class="p-6 pt-0">
                            <div id="result-message" class="p-4 rounded-2xl bg-slate-100 dark:bg-slate-900/50 hidden">
                                <div class="flex items-start gap-3">
                                    <svg id="result-icon" class="w-5 h-5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
                                    <div class="flex-1">
                                        <div id="result-title" class="font-semibold text-sm mb-1"></div>
                                        <div id="result-text" class="text-xs text-slate-600 dark:text-slate-400"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Editorial Section (省略保持不变) -->
    </main>    <!-- Unified Component Management (Header + Footer + Theme) -->
    <script src="../assets/js/components.js"></script>

    <!-- Tool-specific Logic -->

    <script>
        // === Tool Logic ===
        const csvInput = document.getElementById('csv-input');
        const jsonOutput = document.getElementById('json-output');
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const dropOverlay = document.getElementById('drop-overlay');
        const uploadedFilesSection = document.getElementById('uploaded-files');
        const fileList = document.getElementById('file-list');
        const fileCount = document.getElementById('file-count');
        const processedFilesSection = document.getElementById('processed-files');
        const processedList = document.getElementById('processed-list');
        
        const delimiterSelect = document.getElementById('delimiter');
        const hasHeaderCheckbox = document.getElementById('has-header');
        const formatOutputCheckbox = document.getElementById('format-output');
        
        const uploadBtn = document.getElementById('upload-btn');
        const pasteBtn = document.getElementById('paste-btn');
        const clearBtn = document.getElementById('clear-btn');
        const convertBtn = document.getElementById('convert-btn');
        const convertBtnText = document.getElementById('convert-btn-text');
        const sampleBtn = document.getElementById('sample-btn');
        const copyBtn = document.getElementById('copy-btn');
        const downloadAllBtn = document.getElementById('download-all-btn');
        
        const inputStatus = document.getElementById('input-status');
        const statusIcon = document.getElementById('status-icon');
        const statusText = document.getElementById('status-text');
        
        const resultMessage = document.getElementById('result-message');
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultText = document.getElementById('result-text');
        
        const statObjects = document.getElementById('stat-objects');
        const statFields = document.getElementById('stat-fields');
        const statSize = document.getElementById('stat-size');

        let uploadedFiles = [];
        let processedResults = [];

        // Sample CSV data
        const sampleData = `name,age,city,active,score
John Doe,30,New York,true,95.5
Jane Smith,25,Los Angeles,true,87.3
Bob Johnson,35,Chicago,false,92.1
Alice Williams,28,Houston,true,89.7`;

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }

        function showResult(type, title, text) {
            resultMessage.classList.remove('hidden');
            resultMessage.classList.remove('bg-green-50', 'dark:bg-green-900/20', 'bg-red-50', 'dark:bg-red-900/20');
            
            if (type === 'success') {
                resultMessage.classList.add('bg-green-50', 'dark:bg-green-900/20');
                resultIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
                resultIcon.classList.add('text-green-600', 'dark:text-green-400');
                resultIcon.classList.remove('text-red-600', 'dark:text-red-400');
                resultTitle.classList.add('text-green-700', 'dark:text-green-400');
                resultTitle.classList.remove('text-red-700', 'dark:text-red-400');
            } else {
                resultMessage.classList.add('bg-red-50', 'dark:bg-red-900/20');
                resultIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
                resultIcon.classList.add('text-red-600', 'dark:text-red-400');
                resultIcon.classList.remove('text-green-600', 'dark:text-green-400');
                resultTitle.classList.add('text-red-700', 'dark:text-red-400');
                resultTitle.classList.remove('text-green-700', 'dark:text-green-400');
            }
            
            resultTitle.textContent = title;
            resultText.textContent = text;
        }

        function hideResult() {
            resultMessage.classList.add('hidden');
        }

        function updateStats(json, objectCount, fieldCount) {
            statObjects.textContent = objectCount.toLocaleString();
            statFields.textContent = fieldCount.toLocaleString();
            const bytes = new Blob([json]).size;
            statSize.textContent = formatBytes(bytes);
        }

        function updateFileList() {
            if (uploadedFiles.length === 0) {
                uploadedFilesSection.classList.add('hidden');
                fileList.innerHTML = '';
                convertBtnText.textContent = 'Convert to JSON';
                return;
            }
            
            uploadedFilesSection.classList.remove('hidden');
            fileCount.textContent = `${uploadedFiles.length} file${uploadedFiles.length > 1 ? 's' : ''}`;
            convertBtnText.textContent = `Process ${uploadedFiles.length} File${uploadedFiles.length > 1 ? 's' : ''}`;
            
            fileList.innerHTML = uploadedFiles.map((file, index) => `
                <div class="flex items-center justify-between p-2 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                        <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="font-medium truncate">${file.name}</span>
                        <span class="text-slate-500 dark:text-slate-400">(${formatBytes(file.size)})</span>
                    </div>
                    <button onclick="removeFile(${index})" class="ml-2 p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded text-red-600 dark:text-red-400 transition">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `).join('');
        }

        function updateProcessedList() {
            if (processedResults.length === 0) {
                processedFilesSection.classList.add('hidden');
                return;
            }
            
            processedFilesSection.classList.remove('hidden');
            processedList.innerHTML = processedResults.map((result, index) => `
                <div class="flex items-center justify-between p-3 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs">
                    <div class="flex items-center gap-2 flex-1 min-w-0">
                        <svg class="w-4 h-4 ${result.success ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'} flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            ${result.success ? 
                                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>' : 
                                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
                        </svg>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium truncate">${result.fileName}</div>
                            ${result.success ? 
                                `<div class="text-slate-500 dark:text-slate-400">${formatBytes(result.size)} • ${result.objects} objects</div>` : 
                                `<div class="text-red-600 dark:text-red-400">${result.error}</div>`}
                        </div>
                    </div>
                    ${result.success ? `
                        <button onclick="downloadSingleFile(${index})" class="ml-2 px-2 py-1 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/40 rounded transition flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Download
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        window.removeFile = function(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
        };

        window.downloadSingleFile = function(index) {
            const result = processedResults[index];
            if (result && result.success) {
                const blob = new Blob([result.content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = result.fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        };

        function handleFiles(files) {
            const newFiles = Array.from(files).filter(file => 
                file.type === 'text/csv' || file.name.endsWith('.csv') || file.name.endsWith('.txt')
            );
            
            if (newFiles.length === 0) {
                showResult('error', 'Invalid Files', 'Please upload CSV or text files only.');
                return;
            }
            
            uploadedFiles = [...uploadedFiles, ...newFiles];
            updateFileList();
            csvInput.value = '';
            hideResult();
        }

        // Drag & Drop handlers
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        dropZone.addEventListener('click', (e) => {
            if (e.target === csvInput) return;
            fileInput.click();
        });

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropOverlay.classList.remove('hidden');
                dropOverlay.classList.add('flex');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropOverlay.classList.add('hidden');
                dropOverlay.classList.remove('flex');
            });
        });

        dropZone.addEventListener('drop', (e) => {
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            fileInput.value = '';
        });

        function parseCSVLine(line, delimiter) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === delimiter && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function convertValue(value) {
            value = value.replace(/^["']|["']$/g, '');
            if (value === '' || value.toLowerCase() === 'null') return null;
            if (value.toLowerCase() === 'true') return true;
            if (value.toLowerCase() === 'false') return false;
            if (!isNaN(value) && value.trim() !== '') return Number(value);
            return value;
        }

        function csvToJSON(csvData, delimiter, hasHeader, prettify) {
            const lines = csvData.trim().split('\n').filter(line => line.trim());
            if (lines.length === 0) throw new Error('CSV data is empty');
            
            const parsedLines = lines.map(line => parseCSVLine(line, delimiter));
            let headers, dataLines;
            
            if (hasHeader) {
                headers = parsedLines[0];
                dataLines = parsedLines.slice(1);
            } else {
                const columnCount = parsedLines[0].length;
                headers = Array.from({ length: columnCount }, (_, i) => `column${i + 1}`);
                dataLines = parsedLines;
            }
            
            const jsonArray = dataLines.map(line => {
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = convertValue(line[index] || '');
                });
                return obj;
            });
            
            return {
                data: jsonArray,
                json: prettify ? JSON.stringify(jsonArray, null, 2) : JSON.stringify(jsonArray),
                objectCount: jsonArray.length,
                fieldCount: headers.length
            };
        }

        async function convertCSV() {
            const delimiter = delimiterSelect.value === '\\t' ? '\t' : delimiterSelect.value;
            const hasHeader = hasHeaderCheckbox.checked;
            const prettify = formatOutputCheckbox.checked;
            
            if (uploadedFiles.length === 0) {
                const input = csvInput.value.trim();
                if (!input) {
                    showResult('error', 'Empty Input', 'Please paste CSV data or upload files.');
                    return;
                }
                
                try {
                    const result = csvToJSON(input, delimiter, hasHeader, prettify);
                    jsonOutput.value = result.json;
                    showResult('success', 'Conversion Successful', 
                        `Successfully converted ${result.objectCount} rows with ${result.fieldCount} fields each.`);
                    updateStats(result.json, result.objectCount, result.fieldCount);
                } catch (e) {
                    showResult('error', 'Conversion Failed', e.message);
                    jsonOutput.value = '';
                    updateStats('', 0, 0);
                }
                return;
            }
            
            // Process uploaded files
            processedResults = [];
            
            for (const file of uploadedFiles) {
                try {
                    const content = await file.text();
                    const result = csvToJSON(content, delimiter, hasHeader, prettify);
                    
                    processedResults.push({
                        fileName: file.name.replace(/\.(csv|txt)$/, '') + '.json',
                        content: result.json,
                        size: new Blob([result.json]).size,
                        objects: result.objectCount,
                        success: true
                    });
                } catch (error) {
                    processedResults.push({
                        fileName: file.name,
                        error: error.message,
                        success: false
                    });
                }
            }
            
            updateProcessedList();
            
            const successCount = processedResults.filter(r => r.success).length;
            const failCount = processedResults.length - successCount;
            
            if (successCount > 0) {
                showResult('success', 'Processing Complete', 
                    `Successfully processed ${successCount} file${successCount > 1 ? 's' : ''}${failCount > 0 ? `, ${failCount} failed` : ''}.`);
                
                const firstSuccess = processedResults.find(r => r.success);
                if (firstSuccess) {
                    jsonOutput.value = firstSuccess.content;
                    updateStats(firstSuccess.content, firstSuccess.objects, firstSuccess.objects);
                }
            } else {
                showResult('error', 'Processing Failed', 'All files failed to process.');
            }
        }

        convertBtn.addEventListener('click', convertCSV);

        downloadAllBtn.addEventListener('click', () => {
            const successResults = processedResults.filter(r => r.success);
            if (successResults.length === 0) return;
            
            successResults.forEach((result, index) => {
                setTimeout(() => {
                    const blob = new Blob([result.content], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = result.fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, index * 100);
            });
        });

        pasteBtn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                csvInput.value = text;
                hideResult();
            } catch (err) {
                console.error('Failed to paste:', err);
            }
        });

        clearBtn.addEventListener('click', () => {
            csvInput.value = '';
            jsonOutput.value = '';
            uploadedFiles = [];
            processedResults = [];
            updateFileList();
            updateProcessedList();
            hideResult();
            updateStats('', 0, 0);
            fileInput.value = '';
        });

        sampleBtn.addEventListener('click', () => {
            csvInput.value = sampleData;
            uploadedFiles = [];
            updateFileList();
            hideResult();
        });

        copyBtn.addEventListener('click', () => {
            const output = jsonOutput.value;
            if (!output) {
                showResult('error', 'Nothing to Copy', 'Convert CSV to JSON first.');
                return;
            }
            
            navigator.clipboard.writeText(output).then(() => {
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!';
                copyBtn.classList.remove('bg-green-50', 'text-green-600');
                copyBtn.classList.add('bg-green-600', 'text-white');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('bg-green-600', 'text-white');
                    copyBtn.classList.add('bg-green-50', 'text-green-600');
                }, 2000);
            });
        });

        // Auto-detect CSV format
        let detectionTimeout;
        csvInput.addEventListener('input', () => {
            clearTimeout(detectionTimeout);
            detectionTimeout = setTimeout(() => {
                const input = csvInput.value.trim();
                if (input && uploadedFiles.length === 0) {
                    const lines = input.split('\n').filter(line => line.trim());
                    if (lines.length > 0) {
                        inputStatus.classList.remove('hidden');
                        inputStatus.classList.remove('text-red-600');
                        inputStatus.classList.add('text-green-600');
                        statusIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
                        statusText.textContent = `${lines.length} line${lines.length !== 1 ? 's' : ''} detected`;
                    }
                } else {
                    inputStatus.classList.add('hidden');
                }
            }, 500);
        });

        // Initialize
        updateStats('', 0, 0);
    </script>
</body>
</html>
